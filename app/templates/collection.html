{% extends "base.html" %}

{% block title %}Meine Sammlung{% endblock %}

{% block content %}
<h1 class="mb-4">Meine Sammlung</h1>

{% if collection_by_era %}
    <p>Du hast {{ total_cards }} Karte(n) in deiner Sammlung.</p>

    {% for era, sets in collection_by_era.items()|sort(attribute='0.id') %}
        <h2 class="mt-4">{{ era.name }}</h2>
        <hr>
        <div class="accordion" id="accordion-{{ era.id }}">
            {% for set, cards in sets.items()|sort(attribute='0.release_date') %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="heading-{{ set.id }}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ set.id }}" aria-expanded="false" aria-controls="collapse-{{ set.id }}">
                            <!-- Wrapper-Div für korrekte Ausrichtung -->
                            <div class="d-flex w-100 justify-content-between align-items-center pe-3">
                                <span class="text-truncate">{{ set.name }}</span>
                                <span class="badge bg-primary rounded-pill">{{ cards|length }} / {{ set.cards|length }}</span>
                            </div>
                        </button>
                    </h2>
                    <div id="collapse-{{ set.id }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ set.id }}" data-bs-parent="#accordion-{{ era.id }}">
                        <div class="accordion-body">
                            <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-3">
                                {% for card in cards %}
                                    <div class="col">
                                        <div class="card h-100 text-center">
                                            <a href="#"
                                               data-bs-toggle="modal"
                                               data-bs-target="#cardDetailModal"
                                               data-card-url="{{ url_for('main.card_modal', card_id=card.id) }}">
                                                <img src="{{ url_for('static', filename=card.image_path) }}" class="card-img-top" alt="{{ card.name }}">
                                            </a>                                            
                                            <div class="card-body p-2">
                                                <h6 class="card-title fs-sm mb-1">{{ card.name }}</h6>
                                                <p class="card-text small text-muted">{{ card.number }}</p>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endfor %}
{% else %}
    <p>Deine Sammlung ist noch leer.</p>
    <a href="{{ url_for('main.card_search') }}" class="btn btn-primary">Finde Karten zum Hinzufügen!</a>
{% endif %}
{% endblock %}